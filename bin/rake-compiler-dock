#!/usr/bin/env ruby

pwd = Dir.pwd
uid = Process.uid
gid = Process.gid
user = `id -nu`.chomp
group = `id -ng`.chomp
args = ARGV.empty? ? ['bash'] : ARGV

cmd = ["docker", "run", "--rm", "-i", "-t",
       "-v", "#{pwd}:#{pwd}",
       "-e", "UID=#{uid}",
       "-e", "GID=#{gid}",
       "-e", "USER=#{user}",
       "-e", "GROUP=#{group}",
       "-w", pwd,
       "larskanis/rake-compiler-dock",
       "sigfw", "runas", *args]

puts cmd.join(" ")
system *cmd
